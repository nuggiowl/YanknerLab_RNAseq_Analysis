# YanknerLab_RNAseq_Analysis
This github page contains RNAseq analysis pipeline for the paper "Lithium Deficiency and the Onset of Alzheimer’s Disease"

## Single-nucleus RNA-seq
Sample preparation: We performed snRNA-seq on the hippocampus of 12-month-old 3xTg mice that were fed a Li-deficient (n=5 mice) or chemically-defined control (n=4 mice) diet for 5 weeks. Mice were transcardially perfused with ice-cold PBS and a cocktail of transcription inhibitors (company?) at a speed of 6 ml/min for 8 mins to repress transcriptional response during the brain dissection and sample preparation76,77. Hippocampal tissue was dissected on ice and flash frozen in liquid nitrogen. Both frozen hippocampal tissues were subsequently thawed together in 500 µl of HB buffer (0.25M sucrose, 25mM KCl, 5mM MgCl2, 20mM Tricine-KOH, pH=7.8, 1mM DTT, 0.15mM spermine and 0.5mM spermidine) and homogenized with tight pestle of dounce homogenizer in the same HB buffer with additional 0.32% of IGEPAL (Sigma) (average of 25-30 times per sample) on ice. Subsequently, single nuclei were diluted to 9 ml in HB buffer, passed through the 40-μm filter, and separated from debris and multi-nuclei by iodixanol gradient centrifugation. Specifically, we prepared 50% iodixanol solution by diluting 60% iodixanol (Optiprep Density Gradient Medium, Sigma D1556) with diluent (150mM KCl, 30mM MgCl2, 120mM Tricine-KOH pH7.8, and subsequently diluted them with HB buffer and supplemented with 0.04% BSA and 64U/ml RNasin® Plus Ribonuclease Inhibitor (Promega, N2611) to prepare 40% iodixanol and 30% iodixanol. We layered 1 ml of 40% iodixanol in the bottom, 1 ml of 30% iodixanol in the middle, and gently layered 9 ml of the diluted nuclei suspension on top of the 30% iodixanol layer. The three layers were visually confirmed to be distinct, and subjected to 18 minutes, 10,000g centrifugation. Single nuclei were carefully recovered from the 30% iodixanol layer in between the 30% and 40% interface. An aliquot was taken for trypan blue staining and visual inspection of nucleic morphology under the microscope, which showed a homogeneous size distribution and absence of major debris or doublets. The numbers of nuclei were counted by hemocytometer and subsequently confirmed by automated counter in the Harvard single cell core (Supplementary Table 3). The remainder of the nucleic suspension was diluted for nuclei encapsulation and sequencing library preparation at the Harvard Single Cell Core, according to the 10X Genomics manual. The size and quality of the prepared libraries were confirmed on Agilent high sensitivity TapeStation, and the library was independently quantified by qPCR. The prepared libraries were sequenced by Nova-Seq S4 at Harvard Biopolymers Facility, at an average coverage of 32,897 reads per nucleus (Supplementary Table 3). Sequencing data and individual animal metadata have been deposited at NCBI Gene Expression Omnibus GSE272344 and linked to BioProject PRJNA1136488.

Single-nucleus RNA-seq quality control: We aligned the demultiplexed raw sequencing reads to the mouse genome (mm10 from 10X genomics) using Cell Ranger (6.1.2)78, with –include-introns option, to account for nuclear pre-mRNAs. The generated counts table was loaded to Seurat (v4)79 to generate Seurat objects. Cells with more than 10 percent of reads being attributed to mitochondrial transcripts were filtered. Cells that express less than 200 features (low-quality cells) or higher than 8,000 features (apparent doublets) were also filtered. These thresholds are determined by visual inspection of the distribution of features among cells (Seurat, VlnPlot) and generally consistent with other reports65,80. The cells that pass quality controls are log normalized using NormalizeData function from Seurat with a scale factor of 10,000. Variable features are identified using FindVariableFeatures function from Seurat with vst selection method and 2000 features. Data was scaled using ScaleData, and PCA was performed using RunPCA with the identified variable features using Seurat. Nearest neighbors were found using FindNeighbors using dimension 1:30, which was determined by ElbowPlot following Seurat’s manual. The number of clusters was determined by FindClusters function using Seurat v4. UMAP and TSNE were performed using RunUMAP or RunTSNE using Seurat with dimensions 1:30 and do.fast=TRUE parameter. Potential doublets were removed using DoubletFinder (v3)81 following the default parameters. The vast majority of the cells passed these quality controls, and the number of cells before and after filtration was documented (have data?). After filtration, cluster-specific markers are determined by FindAllMarkers function (Seurat v4), with parameters only.pos = F, min.pct = 0.25 and max.cell.per.ident = 500. Where can Supplementary Table 3 be referenced?

Cell-type-specific annotation and differential gene expression analyses for snRNA-seq: Cell types were identified by cross-referencing the transcriptome of each individual cell to the Mouse Cell Atlas82 and independently validated by confirming the expression of established cell type-specific markers, on a cluster-to-cluster basis. Violin and heat scatter plots to demonstrate the expression distribution of selected established markers are plotted using VlnPlot and FeaturePlot functions from Seurat. Examples of cell type markers include Slc17a7 (excitatory neurons), Prox1 (granule cells), Gad1, Gad2 (inhibitory neurons), Mbp (oligodendrocytes), Aldoc, Aqp4 (astrocytes), Pdgfra (oligodendrocyte precursor cells), Vtn (pericytes). Cx3cr1, Tgfbr1 (microglia), Cldn5, Flt1 (endothelial cells), Prlr, Folr1 (choroid plexus cells; see Supplementary Figure 4). Cell type-specific abundance and differential gene expression analyses were performed on the major cell types (excitatory neurons, inhibitory neurons, granule cells, microglia, astrocytes, oligodendrocytes, oligodendrocyte precursor cells and endothelial cells). Clusters of the same cell types were combined to increase the statistical power, as described76,77,83, and clusters with mixed cell types (<80% homogenous) were removed for cell type-specific analyses. Relative abundance of each cell type was computed by dividing the number of cells of the particular cell type by the total number of cells. Two-tailed unpaired Student’s t-tests were performed to determine if there were significant differences in the relative abundance of each cell type between the control and lithium deficient conditions. Differentially expressed genes (DEGs) were computed by the MAST84 test in Seurat. Genes expressed in less than 1% of the cells in each cell type were filtered out. All the differentially expressed genesDEGs (FDR<0.05) are reported in the Supplemental Table 4. DEGs with FDR<0.05 and |log₂FC| > 0.1 were used for gene ontology enrichment analyses using Metascape85 v3.5.20240101. The heat scatter plot for differentially expressed genesDEGs (Fig. 3d) was generated using the FeaturePlot function from Seurat.

Purified microglia RNA-seq
Microglia purification: Li-deficient or control WT and 3xTg mice were perfused transcardially using PBS at 4°C. The cortex and hippocampus were quickly dissected and pooled, then minced using a scalpel, before transferring to 5 ml dissection buffer (HBSS without calcium and magnesium) and Protector RNase inhibitor (Sigma) at 4°C in a Dounce homogenizer. Brain samples were dounced 20 times with a loose and 10 times with a tight pestle. The cell suspension was passed through a pre-wet 70-micron cell strainer into a pre-chilled 15 ml tube. Cells are then spun down at 300xg for 10 min at 4°C. Cell pellets were resuspended in 10 ml ice-cold 40% Percoll (GE Healthcare) and centrifuged at 800xg for 20 minutes at 4°C. Myelin debris was removed by vacuum suction and the cell pellet was washed with 5 ml ice cold HBSS and spun again for 5 minutes at 300g, 4°C. The pellets were then resuspended in 180 μl ice-cold MACs buffer (0.5% BSA, 2mM EDTA, Protector RNase inhibitor in PBS) with 20 μL CD11b microbeads (Miltenyi Biotec, 130-049-601) and incubated on ice for 15 minutes. After incubation, 1 ml of MACs buffer was added to samples and cells were centrifuged for 5 minutes at 300g and 4°C. Microglia were then isolated using LS columns with QuadroMACS™ Separator following the manufacturer’s instructions. Briefly, LS columns were pre-washed three times with 3 ml of MACs buffer. Samples were resuspended in 500 µl MACs buffer and transferred to LS columns, followed by three additional washes with 3 ml MACs buffer. Finally, microglia were released with 5 ml of MACs buffer (without EDTA), then used for RNA extraction.

Microglia RNA sequencing quality control and analysis: Total microglial RNA was extracted from MACs-purified microglia using RNAzol® RT (Sigma, R4533). RNA extracted from each microglial preparation was quantified using an Agilent Tapestation 4200 instrument, with a corresponding Agilent Tapestation High Sensitivity RNA assay (catalog no. 5067-5579). The samples were normalized to 4 ng of input in 9.5 μl, and the polyadenylated mRNA was selected for using 3' SMART-Seq CDS Primer II A as part of the Takara SMART-Seq v4 Ultra Low Input RNA (Catalog No. 634894) workflow, which generated cDNA. From there, an Agilent Bioanalyzer High Sensitivity DNA assay (catalog no. 5067-4626) was used to quantify cDNA concentration. Libraries were obtained using the Illumina NexteraXT kit (catalog no. FC-131-1096). Adapter ligation, indexing, and amplification were conducted subsequently as part of the same workflow. Following amplification, residual primers were eluted away using KAPA Pure Beads (catalog no. 07983298001) in a 0.6x SPRI-based cleanup. The resulting purified libraries were run on an Agilent 4200 Tapestation instrument, with a corresponding Agilent D5000 ScreenTape assay (catalog no. 5067-5588, 5067-5589) to visualize the libraries and check the size and concentration of each library. Molarity values obtained from this assay were used to normalize all samples in equimolar ratio for one final pool. The pool was denatured and loaded onto an Illumina NovaSeq 6000 instrument, with a single lane of an S4 flowcell to obtain Paired-End 100bp reads. The pool was loaded at 200 pM (normalized to 1nM pre-denaturation), with 1% PhiX spiked in as a sequencing control. The basecall files were demultiplexed through the Harvard BPF Genomics Core pipeline, and the resulting fastq files were used in subsequent analysis. Raw RNA-sequencing data in FASTQ format were subjected to quality assessment using FastQC (version 0.11.9) and sequencing reads are aligned to mouse genome (mm10) using STAR aligner86 with the following options:  --outFilterMismatchNmax 999 --outFilterMismatchNoverLmax 0.04 --alignSJDBoverhangMin 1 --alignSJoverhangMin 8 --outFilterMultimapNmax 20 --outFilterType BySJout --alignIntronMin 20 --alignIntronMax 1000000 --alignMatesGapMax 1000000. Microglia RNAseq yielded an average of 100 million uniquely mapped reads for each sample and gene expression levels were quantified using htseq-count87.  To reduce computational burden and focus on biologically relevant genes, we initially pre-filtered the count data. Genes were retained if they had at least 5 counts in at least 3 samples. To validate the purity of the isolated microglia, we determined that microglial marker (Csf1r, P2ry12, Tmem119) were strongly enriched, whereas neuronal (Map2, Nsg2), astrocytic (Gfap, Aldh1l1), and oligodendrocyte (Olig2, Mog) marker genes were negligibly expressed (Supplementary Fig. 7b,c). In addition, we also verified that markers of ex-vivo microglia activation88 (Fos, Jun, Hspa1a and Zfp36) were minimally expressed in our samples (Supplementary Fig. 7b,c). Differential gene expression analysis was conducted using DESeq289 to identify DEGs between Li-def and control microglia, with an adjusted p-value cutoff of 0.05. Signaling pathways and molecular network analyses were performed by integrating DEGs from microglia RNA-seq and snRNA-seq into Ingenuity Pathway Analysis (IPA)90. Significantly enriched signaling pathways and disease/functional annotations were identified and results were ranked based on Fisher’s exact test. Utilizing the build and overlay function in IPA, DEGs that were enriched in top pathways were further visualized as integrated signaling network.

RNA-seq analysis of lithium orotate-treated 3xTg hippocampus
RNA extraction. 12-month-old 3xTg mice that were treated with 4.3 µM Li orotate (n=9 females) or vehicle (water; n=9 females) from 6 to 12 months were transcardially perfused with cold PBS 1x and the hippocampi were rapidly dissected and snap frozen. The total hippocampal RNA was extracted using Trizol reagent (Ambion 15596018) and purified using the Direct-zol RNA Mini Prep kit (Zymo Research, R2050) according to the manufacturer’s instructions. RNA integrity and concentration were assayed using an Agilent 2100 Bioanalyzer instrument. All RNA samples had a RIN>8.2. 

RNA library preparation and sequencing: Libraries were prepared using Illumina TruSeq Stranded mRNA sample preparation kits from 500 ng of purified total RNA according to the manufacturer’s protocol. The finished dsDNA libraries were quantified using Qubit fluorometer, Agilent TapeStation 2200, and RT–qPCR using the Kapa Biosystems library quantification kit according to the manufacturer’s protocols. Uniquely indexed libraries were pooled and sequenced on an Illumina NextSeq 500 with paired-end 75-bp reads by the Dana-Farber Cancer Institute Molecular Biology Core Facilities. Samples were pooled with multiple samples per lane and sequenced. There were 2 sequencing batches (batch 1: n=5 mice/group; batch 2: n=4 mice/group). 

RNA sequencing quality control and quantification of gene expression: Quality control of sequencing reads (see Supplementary Table 14) was performed with FastQC version 0.11.5 (https://www.bioinformatics.babraham.ac.uk/projects/fastqc/). Reads were aligned to the Mouse GRCm38 genome with GENCODE M21 gene models using STAR86 version 2.7.0f with options --outSAMunmapped Within --alignSJDBoverhangMin 1 --alignSJoverhangMin 8 --outFilterMultimapNmax 20 --outFilterType BySJout --alignIntronMin 20 --alignIntronMax 5000000 --alignMatesGapMax 5000000 --twopassMode Basic. The expression of genes was quantified as gene counts using STAR at the same time as alignment with option --quantMode GeneCounts.

Gene expression normalization and covariate adjustment: Gene counts were input to edgeR. Genes were deemed expressed if at least n=9 samples (where n is the group size) had >1 CPM. Genes not satisfying these criteria were removed, keeping the original library sizes. This filtering retained n=14,862 expressed genes out of 55,536 annotated genes for subsequent analyses. Counts were then normalized using the TMM method in edgeR. Finally, log(CPM) values were calculated for analyses other than differential expression. 
	To adjust gene expression for covariates we fit the linear regression model for each gene and cohort separately using lm() in R: gene expression ~ group + covariates where gene expression is log(CPM), and using the group and covariates: factor, two levels: Lithium Orotate and Water (reference level), covariates (sequencing batch (factor, two levels) and 1 RUVr covariate (continuous). The final normalized and adjusted gene expression values were derived from adding the regression residuals to the estimated effect of the group level to preserve the effect of the group on expression. These normalized and adjusted gene expression values were used to perform gene–gene regression analysis and gene–gene group regression analysis, and to visualize gene expression.
To adjust for technical effects we used the RUV with residuals (RUVr) method91 implemented in the RUVSeq version 1.18.0 Bioconductor package. We performed a first pass edgeR analysis as described in section “Differential expression analysis” up to and including the glmFit() step with the covariates listed above excluding the RUVr covariates. Then we used residuals() with argument type=‘deviance’ to obtain a matrix of deviance residuals.  The specified number of unwanted factors (RUVr covariates) used in final analyses were then estimated by the RUVr function using log(CPM) expression values and the residuals. The number of unwanted factors was selected based on separation of groups in principal components plots using normalized and adjusted gene expression values and checking that histograms of differential expression P values showed a uniform or anti-conservative pattern.
Differential expression and gene set enrichment analysis: Differential expression analysis between groups with covariate adjustment using the covariates listed above was performed for expressed genes using edgeR (estimateDisp, glmFit, and glmLRT with default arguments) in R. Genes were considered differentially expressed if FDR < 0.05. Gene ontology enrichment analysis was performed separately for upregulated genes and downregulated genes using Metascape85 v3.5.20240101 and summarized in Supplementary Table 15 and Figure 5f. 

Ingenuity Pathway Analysis
Signaling pathway and molecular network analyses were performed on differentially expressed genes (DEGs) identified from snRNA-seq, microglia RNA-seq, and LiO hippocampus RNA-seq datasets (FDR < 0.05) using Ingenuity Pathway Analysis (IPA)90. Significantly enriched pathways and disease/function annotations were identified and ranked based on Fisher’s exact test. To visualize the results, the top pathway-enriched DEGs were integrated into a signaling network using IPA’s Build and Overlay function (Extended Data Figure 4 and Supplementary Figure 10).

GWAS-DEG enrichment analysis
Prior to conducting the GWAS-DEG enrichment analysis, we converted the mouse gene symbols to human orthologs, using a two-step process. First, the "alias2SymbolTable" function within the "Limma" R package92 was utilized to map any gene aliases to their corresponding main symbols. Subsequently, the resulting gene symbols were converted to human orthologs using the MGI ortholog table93. If there were multiple mapping candidates, all possible conversions were applied. For example, if a mouse gene has multiple human orthologs, records with all relevant human gene symbols were generated. This standardized gene nomenclature facilitated cross-species comparisons in subsequent analyses.
To conduct the GWAS-DEG enrichment analysis microglia isolated from Li-deficient mice, we utilized MAGMA94. The gene set of DEGs identified by microglia bulk RNA-seq analysis was used and the summary statistics from the GWAS catalog - AD (Accession ID: MONDO_0004975)95 were obtained and formatted for MAGMA input. The GWAS catalog - AD contains GWAS records from multiple studies. If multiple records were found for the same variant, we retained the entry with the lowest p-value. Gene-set analysis was conducted using the default MAGMA settings, with multiple testing correction applied to account for the number of gene sets tested. Enrichment results were considered significant at a false discovery rate (FDR) of < 0.05.

Overlap of mouse and human DEGs
To assess the overlap between DEGs derived from our transcriptomic analyses and DEGs derived from the analysis of human brain samples with varying degrees of AD pathology21 (Fig. 3d), we first converted mouse gene symbols to human orthologs, as described above. We matched the cell types analyzed in our mouse studies with those analyzed in humans21. To assess the statistical significance of the overlap between the two DEG sets, we conducted a Fisher's exact test. To control for multiple comparisons arising from the analysis of different cell types and DEG directions (upregulated and downregulated), we adjusted the p-values using the Benjamini-Hochberg procedure. Two sets of adjusted p-values were calculated (Fig. 3d 3e and Supplementary Table 8): One set for the overlap of genes upregulated in both datasets (indicated in red), and another for the overlap of genes downregulated in both datasets (indicated in blue).
